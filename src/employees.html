<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>
    <link rel="stylesheet" href="css/employees.css">
</head>

<body>
    <div class="top-bar">
        <img src="SpaRadise Logo.png" alt="SpaRadise Logo" style="width:180px;height:70px;">
        <nav>
            <nav>
                <ul>
                    <li><a href="booking_employees.html">Book for a Client</a></li>
                    <li><a href="bookinghistory_employee.html">Bookings</a></li>
                    <li><a href="employees.html">Employees</a></li>
                    <li><a href="clients.html">Clients</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="packages.html">Packages</a></li>
                    <li><a href="vouchers.html">Vouchers</a></li>
                    <li><a href="index_employee.html">Home</a></li>
                </ul>
            </nav>
    </div>

    <div class="container">
        <div class="employee-list">
            <h1>Employee List</h1>

            <div class="search-sort">
                <input type="text" id="search-bar" oninput="searchEmployees()" placeholder="Search employees...">
                <button class="sort-btn" onclick="sortEmployees()">↑</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Doe, John, A.</td>
                        <td>
                            <button class="action-btn" onclick="window.location.href='employees.html'">Update</button>
                            <button class="action-btn" onclick="deleteEmployee('Doe, John, A.')">Delete</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Smith, Jane, B.</td>
                        <td>
                            <button class="action-btn" onclick="window.location.href='employees.html'">Update</button>
                            <button class="action-btn" onclick="deleteEmployee('Smith, Jane, B.')">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button class="action-btn" onclick="window.location.href='employees.html'">Add New Employee</button>
        </div>

        <div class="employee-details">
            <h1>Edit Employee Details</h1>
            <form action="submit-employee-details.html" method="POST">
                <div class="form-section">
                    <h2>Personal Information</h2>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="last-name">Last Name</label>
                            <input type="text" id="last-name" name="last_name" required>
                        </div>
                        <div class="form-group">
                            <label for="first-name">First Name</label>
                            <input type="text" id="first-name" name="first_name" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="middle-name">Middle Name</label>
                        <input type="text" id="middle-name" name="middle_name">
                    </div>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="sex">Sex</label>
                            <select id="sex" name="sex" required>
                                <option value="" disabled selected>Select sex</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="birthdate">Birthdate</label>
                            <input type="date" id="birthdate" name="birthdate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="contact-number">Contact Number</label>
                            <input type="tel" id="contact-number" name="contact_number" required>
                        </div>
                        <div class="form-group">
                            <label for="alt-contact-number">Alternative Contact Number</label>
                            <input type="tel" id="alt-contact-number" name="alt_contact_number">
                        </div>
                    </div>
                </div>

                <!-- Address Section -->
                <div class="form-section">
                    <h2>Address</h2>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="building-number">Building Number</label>
                            <input type="text" id="building-number" name="building_number">
                        </div>
                        <div class="form-group">
                            <label for="street">Street</label>
                            <input type="text" id="street" name="street">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="barangay">Barangay</label>
                        <input type="text" id="barangay" name="barangay">
                    </div>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" required>
                        </div>
                        <div class="form-group">
                            <label for="province">Province</label>
                            <input type="text" id="province" name="province" required>
                        </div>
                    </div>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="region">Region</label>
                            <select id="region" name="region" required>
                                <option value="" disabled selected>Select region</option>
                                <option value="NCR">National Capital Region (NCR)</option>
                                <option value="CAR">Cordillera Administrative Region (CAR)</option>
                                <option value="I">Ilocos Region (Region I)</option>
                                <option value="II">Cagayan Valley (Region II)</option>
                                <option value="III">Central Luzon (Region III)</option>
                                <option value="IVA">CALABARZON (Region IV-A)</option>
                                <option value="IVB">MIMAROPA (Region IV-B)</option>
                                <option value="V">Bicol Region (Region V)</option>
                                <option value="VI">Western Visayas (Region VI)</option>
                                <option value="VII">Central Visayas (Region VII)</option>
                                <option value="VIII">Eastern Visayas (Region VIII)</option>
                                <option value="IX">Zamboanga Peninsula (Region IX)</option>
                                <option value="X">Northern Mindanao (Region X)</option>
                                <option value="XI">Davao Region (Region XI)</option>
                                <option value="XII">SOCCSKSARGEN (Region XII)</option>
                                <option value="CARAGA">Caraga Region</option>
                                <option value="BARMM">Bangsamoro Autonomous Region in Muslim Mindanao (BARMM)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="postal">Postal Code</label>
                            <input type="text" id="postal" name="postal" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="country">Country</label>
                        <select id="country" name="country" required>
                            <option value="" disabled selected>Select country</option>
                            <option value="PH">Philippines</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="GB">United Kingdom</option>
                            <option value="AU">Australia</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="CN">China</option>
                            <option value="IN">India</option>
                            <option value="SG">Singapore</option>
                            <option value="MY">Malaysia</option>
                            <option value="ID">Indonesia</option>
                            <option value="TH">Thailand</option>
                            <option value="VN">Vietnam</option>
                            <option value="NZ">New Zealand</option>
                            <!-- Add more countries as needed -->
                        </select>
                    </div>
                </div>

                <!-- Job Information Section -->
                <div class="form-section">
                    <h2>Job Information</h2>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="job-role">Job Role</label>
                            <select id="job-role" name="job_role" required>
                                <option value="" disabled selected>Select job role</option>
                                <option value="massage-therapist">Massage Therapist</option>
                                <option value="receptionist">Receptionist</option>
                                <option value="nail-technician">Nail Technician</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="job-status">Job Status</label>
                            <select id="job-status" name="job_status" required>
                                <option value="" disabled selected>Select job status</option>
                                <option value="full-time">Full-Time</option>
                                <option value="part-time">Part-Time</option>
                                <option value="contract">Contract</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="date-hired">Date Hired</label>
                        <input type="date" id="date-hired" name="date_hired" required>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" onclick="window.location.href='employeeslist.html'"
                        class="btn btn-cancel">Cancel</button>
                    <button type="submit" class="btn btn-submit">Save Changes</button>
                    <button type="button" onclick="confirmDelete()" class="btn btn-delete">Delete Employee</button>
                </div>
            </form>
        </div>
    </div>

    <script>

        let employees = [
            { id: 1, firstName: 'John', middleName: 'A', lastName: 'Doe' },
            { id: 2, firstName: 'Jane', middleName: 'B', lastName: 'Smith' }
        ];

        let sortAscending = true;

        function loadEmployees() {
            const employeeRows = document.querySelector('tbody'); // Use the correct selector for tbody
            employeeRows.innerHTML = '';
            employees.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${employee.lastName}, ${employee.firstName} ${employee.middleName}</td>
            <td>
                <button class="action-btn" onclick="editEmployee(${employee.id})">Update</button>
                <button class="action-btn" onclick="deleteEmployee(${employee.id})">Delete</button>
            </td>
        `;
                employeeRows.appendChild(row);
            });
        }

        function searchEmployees() {
            const searchQuery = document.getElementById('search-bar').value.toLowerCase();
            const filteredEmployees = employees.filter(employee =>
                `${employee.firstName} ${employee.middleName} ${employee.lastName}`.toLowerCase().includes(searchQuery)
            );

            displayEmployees(filteredEmployees);
        }

        function displayEmployees(employeesToDisplay) {
            const employeeRows = document.querySelector('tbody'); // Use the correct selector for tbody
            employeeRows.innerHTML = '';
            employeesToDisplay.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${employee.lastName}, ${employee.firstName} ${employee.middleName}</td>
            <td>
                <button class="action-btn" onclick="editEmployee(${employee.id})">Update</button>
                <button class="action-btn" onclick="deleteEmployee(${employee.id})">Delete</button>
            </td>
        `;
                employeeRows.appendChild(row);
            });
        }

        function sortEmployees() {
            employees.sort((a, b) => {
                const fullNameA = `${a.lastName}, ${a.firstName} ${a.middleName}`;
                const fullNameB = `${b.lastName}, ${b.firstName} ${b.middleName}`;
                return sortAscending ? fullNameA.localeCompare(fullNameB) : fullNameB.localeCompare(fullNameA);
            });

            // Toggle the sorting direction and button arrow
            sortAscending = !sortAscending;
            const sortButton = document.querySelector('.sort-btn');
            sortButton.textContent = sortAscending ? '↑' : '↓';

            loadEmployees();
        }

        // Load employees on page load
        window.onload = loadEmployees;


        // Mock database for example purposes
        const employeesDB = {
            emails: new Set(),
            contactNumbers: new Set(),
            altContactNumbers: new Set(),
        };

        function isValidName(name) {
            return /^[A-Za-z\s]+$/.test(name) && name.trim() !== '';
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidContactNumber(number) {
            return /^\d{11}$/.test(number); //ex 09453807081
        }

        function isValidPostalCode(code) {
            return /^\d{4}$/.test(code); // ex 8000 for dava ocity
        }

        function alertUnauthorized() {
            alert("Unauthorized access. You cannot edit employee details.");
            return false;
        }

        function preventSubmission(message) {
            alert(message);
            return false;
        }

        function accessAsReceptionist() {
            const isManager = false;

            if (!isManager) {
                alertUnauthorized();
                return false;
            }
        }

        function accessAsManager() {
            const isManager = true;

            if (isManager) {
                return true;
            } else {
                return alertUnauthorized();
            }
        }

        // Add New Employee Validations
        function addNewEmployee(employeeData) {
            const { lastName, middleName, firstName, sex, birthdate, email, contactNumber, altContactNumber, region, province, city, barangay, postalCode, jobRole, dateHired, jobStatus } = employeeData;

            if (!isValidName(lastName)) return preventSubmission("Last name must be valid (not empty, no special characters).");
            if (middleName && !isValidName(middleName)) return preventSubmission("Middle name must be valid (no special characters).");
            if (!isValidName(firstName)) return preventSubmission("First name must be valid (not empty, no special characters).");
            if (!sex) return preventSubmission("Sex not selected.");
            if (!birthdate) return preventSubmission("Invalid birthdate.");
            if (!isValidEmail(email)) return preventSubmission("Email format invalid.");
            if (!isValidContactNumber(contactNumber)) return preventSubmission("Contact number format invalid.");
            if (altContactNumber && !isValidContactNumber(altContactNumber)) return preventSubmission("Alternate contact number invalid.");
            if (!region) return preventSubmission("Region not selected.");
            if (!province) return preventSubmission("Province not selected.");
            if (!city) return preventSubmission("City not selected.");
            if (!barangay) return preventSubmission("Barangay not selected.");
            if (!isValidPostalCode(postalCode)) return preventSubmission("Postal code invalid.");
            if (!jobRole) return preventSubmission("Job role not selected.");
            if (!dateHired) return preventSubmission("Date hired invalid.");
            if (!jobStatus) return preventSubmission("Job status not selected.");
            if (employeesDB.emails.has(email)) return preventSubmission("Email address already exists.");
            if (employeesDB.contactNumbers.has(contactNumber)) return preventSubmission("Contact number already exists.");
            if (altContactNumber && employeesDB.altContactNumbers.has(altContactNumber)) return preventSubmission("Alternate contact number already exists.");

            // If all checks pass
            employeesDB.emails.add(email);
            employeesDB.contactNumbers.add(contactNumber);
            if (altContactNumber) employeesDB.altContactNumbers.add(altContactNumber);
            alert("New employee created successfully.");
            return true;
        }

        // Update Employee Validations (similar to Add New Employee)
        function updateEmployee(employeeData) {
            // Perform similar validations as addNewEmployee
            // Include checks for duplicates as well

            alert("Employee details updated successfully.");
            return true;
        }

        function deleteEmployee(employeeName) {
            const confirmed = confirm(`Are you sure you want to delete ${employeeName}?`);
            if (confirmed) {

                alert(`${employeeName} has been deleted successfully.`);
            }
        }


        // Delete Employee
        function deleteEmployee(employeeId) {
            const isCurrentlyWorking = true; // Placeholder: Check if the employee is currently working

            if (isCurrentlyWorking) {
                return preventSubmission("Employee being updated is currently working.");
            }

            const confirmed = confirm("Are you sure you want to delete this employee?");
            if (confirmed) {
                // Proceed with deletion logic
                alert("Employee deleted successfully.");
                return true;
            }
            return false;
        }

        // Form submission handlers
        document.querySelector('#addEmployeeForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const employeeData = {}; // Collect form data
            addNewEmployee(employeeData);
        });

        document.querySelector('#updateEmployeeForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const employeeData = {}; // Collect form data
            updateEmployee(employeeData);
        });
    </script>
</body>

</html>